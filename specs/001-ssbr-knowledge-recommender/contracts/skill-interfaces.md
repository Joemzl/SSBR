# Skill Interface Contracts

**Date**: 2026-02-28 | **Branch**: `001-ssbr-knowledge-recommender`

本文档定义 SSBR 官能化知识库系统的 Skill 接口契约，包括输入格式、输出格式和调用规范。

---

## Overview

系统包含 5 套 Skill：

| Skill | 文件 | 职责 |
|-------|------|------|
| DSC解读 | `skills/ssbr-dsc-interpretation/SKILL.md` | DSC 谱图自动化解读 |
| NMR解读 | `skills/ssbr-nmr-interpretation/SKILL.md` | ¹H 核磁谱图自动化解读 |
| 应力应变解读 | `skills/ssbr-stress-strain-interpretation/SKILL.md` | 应力-应变曲线自动化解读 |
| TEM解读 | `skills/ssbr-tem-interpretation/SKILL.md` | TEM 形貌自动化解读 |
| 智能推荐 | `skills/ssbr-recommender/SKILL.md` | 官能化方案智能推荐 |

---

## Contract 1: 表征解读 Skill（通用）

### 输入格式

**方式1：指定 Excel 行号**
```
请解读第 {行号} 行样本的 {表征类型}
```

示例：
```
请解读第 3 行样本的 DSC 谱图
```

**方式2：指定样本ID**
```
请解读样本 {样本ID} 的 {表征类型}
```

示例：
```
请解读样本 SSBR-003 的核磁谱图
```

### 输出格式

所有解读 Skill 输出统一的结构化格式：

```markdown
## 一、基础信息
- 样本ID：{从Excel提取}
- 样品名称：{从Excel/文献提取}
- 文献DOI：{从Excel提取}
- 对应Excel列：{表征类型}

## 二、{表征特定信息}
{根据表征类型不同，内容不同}

## 三、核心数据
{提取的关键数据，标注来源层级}

## 四、文献对应结论
{严格复制文献原文结论}
```

### 错误响应

| 错误类型 | 响应格式 |
|----------|----------|
| Excel 行不存在 | `错误：未在/dataset/数据.xlsx中找到指定行的有效信息，请检查行号` |
| PDF 未找到 | `错误：未在/literature/文件夹中找到DOI为{DOI}的对应文献，请检查PDF命名是否符合规则` |
| 图片未找到 | `错误：在对应文献中未找到图注为{图注}的{表征类型}，请检查Excel信息` |

---

## Contract 2: 智能推荐 Skill

### 输入格式

**自然语言查询**，支持以下要素的任意组合：

| 要素 | 格式示例 | 语法说明 |
|------|----------|----------|
| 应用场景 | `用于轮胎胎面`、`做减震材料` | 自然语言描述 |
| 精确值 | `100%定伸应力=4.0MPa`、`Tg=-30℃` | 使用 `=` 表示精确匹配 |
| 大于/小于 | `100%定伸应力>3.5MPa`、`Tg<-25℃` | 使用 `>` 或 `<` 表示范围 |
| 大于等于/小于等于 | `100%定伸应力>=4.0MPa` | 使用 `>=` 或 `<=` |
| 范围 | `100%定伸应力在3.5-4.5MPa之间` | 使用 `在X-Y之间` 或 `X至Y` |
| 偏差容忍 | `允许±10%偏差`、`±5%` | **默认值：±10%**（用户未指定时） |
| Tg 要求 | `Tg达到-30℃`、`Tg在-35至-25℃` | 同上语法 |

**输入语法规范**：

```
性能指标查询语法：
  精确值：  {指标名}={数值}{单位}     例：100%定伸应力=4.0MPa
  大于：    {指标名}>{数值}{单位}     例：拉伸强度>15MPa
  小于：    {指标名}<{数值}{单位}     例：Tg<-25℃
  范围：    {指标名}在{下限}-{上限}{单位}之间
            {指标名}{下限}至{上限}{单位}
  
偏差容忍语法：
  允许±{百分比}%偏差              例：允许±10%偏差
  ±{百分比}%                      例：±5%
  
默认行为：
  - 未指定偏差容忍时，默认 ±10%
  - 未指定应用场景时，搜索全部场景
```

**完整示例**：
```
我想用SSBR做轮胎胎面，希望100%定伸应力达到4.0MPa、Tg达到-30℃，
允许±10%偏差，请给我推荐可能的官能化方案
```

### 输出格式

**有匹配结果时**：

```markdown
## 推荐结果

基于您的需求（{解析后的查询条件}），在知识库中找到 {N} 个匹配方案：

### 推荐 1（匹配度：{完全匹配/偏差X%}）

| 项目 | 内容 |
|------|------|
| 官能化试剂名称 | {名称} |
| 核心官能团 | {官能团} |
| 推荐官能化程度 | {百分比} |
| 实测100%定伸应力 | {数值} MPa |
| 实测Tg | {数值} ℃ |
| 文献来源 | {DOI}, {作者}, {年份} |

**方案说明**：{仅当有确凿文献支撑时输出}

---

### 推荐 2（匹配度：...）
...
```

**无匹配结果时**：

```markdown
## 查询结果

未找到满足以下条件的官能化方案：
- 应用场景：{场景}
- 100%定伸应力：{条件}
- Tg：{条件}
- 偏差容忍：{范围}

建议：
1. 放宽性能指标范围
2. 增加偏差容忍度
3. 检查知识库中是否有相关数据
```

**知识库为空时**：

```markdown
## 查询结果

知识库暂无数据，请先通过解读 Skill 录入样本数据。
```

### 匹配规则

1. **场景过滤优先**：如指定应用场景，先筛选该场景的样本
2. **性能匹配**：
   - 精确匹配：目标值在知识库数值/区间内
   - 偏差匹配：目标值与知识库数值的偏差在容忍范围内
3. **排序规则**：
   - 完全匹配 > 偏差匹配
   - 偏差小 > 偏差大
   - Level 1 数据 > Level 2 数据 > Level 3 数据

### 错误响应

| 错误类型 | 响应格式 |
|----------|----------|
| 无法解析查询 | `无法理解您的查询，请尝试更明确地描述性能指标需求` |
| Excel 读取失败 | `错误：无法读取/dataset/数据.xlsx，请检查文件是否存在` |

---

## Contract 3: 数据录入规范

### 输入格式

用户将解读结果录入 Excel 时，需遵循以下格式：

| 字段 | 格式要求 |
|------|----------|
| 应力数值 | 精确值：`4.2`；区间：`4.0-4.5` |
| 温度数值 | 精确值：`-25.1`；区间：`-30至-20` |
| 百分比 | 数值部分：`3.6`（不含%符号） |
| 缺失数据 | `-` |
| 数据来源 | `Table 1` / `图面标注` / `曲线估读` |

### 必填字段检查

录入新样本时，系统（或用户自检）需验证以下必填字段：

- [ ] 样本ID（唯一）
- [ ] 样品名称
- [ ] 官能化试剂名称
- [ ] 核心官能团
- [ ] 文献DOI

---

## Integration Points

### 固定路径

| 资源 | 路径 |
|------|------|
| Excel 数据集 | `/dataset/数据.xlsx` |
| 文献库 | `/literature/` |
| Skill 文件夹 | `/skills/{skill-name}/SKILL.md` |

### PDF 命名规范

```
{DOI}_{第一作者}_{年份}.pdf
```

- DOI 中的 `/` 替换为 `_`
- 示例：`10.1039_c9ra02783a_Gao_2019.pdf`

---

## Versioning

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-02-28 | Initial contract definition |
